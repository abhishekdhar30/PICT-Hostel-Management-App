<%-include("../navigation")-%>


  <script src="https://cdn.anychart.com/releases/8.0.1/js/anychart-core.min.js"></script>
  <script src="https://cdn.anychart.com/releases/8.0.1/js/anychart-pie.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">

  <link rel="stylesheet" href="css/clock.css">

 


      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/dataTables.material.min.css">


  <!-- Begin Page Content -->
  <div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
      <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
      <a type="button" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" onclick="pdf()"><i
          class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
    </div>





    <%let total=0%>

     <%if(users!="NULL"){%>

     <%total=users.length%>
     <%}%> 




    <!-- Content Row -->
    <div class="row" id="wrap">

      <!-- Earnings (Monthly) Card Example -->
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                  Total Number of students
                </div>


  <div class="h5 mb-0 font-weight-bold text-gray-800">
    <div class="row no-gutters align-items-center">
      <div class="col-auto">
        <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800"> <%=total%></div>
      </div>
      <div class="col">
        <div class="progress progress-sm mr-2">
          <div class="progress-bar bg-primary" role="progressbar" style="width:100%" aria-valuenow="<%=total%>" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>

              

                
                </div>
              </div>
              <div class="col-auto">
                <i class="fas fa-user-friends fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
 <%let present=0%>
 <%let absent=0%>
 <% let home=0%>


 <%if(dailyattendance){%>

 <%for (const [key, value] of dailyattendance) {%>
     
  <%if(value=="Hostel"){%>

  <%present++;%>
  <%}%>

  <%if(value=="Outside"){%>

  <%absent++;%>
  <%}%>

 

  <%if(value=="Home"){%>

  <%home++;%>
  <%}%>


 <%}%>
  
 <%}%>




      <!-- Earnings (Monthly) Card Example -->
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                  Currently in Hostel</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                   <div class="row no-gutters align-items-center">
                     <div class="col-auto">
                       <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800"> <%=present%></div>
                     </div>
                     <div class="col">
                       <div class="progress progress-sm mr-2">
                         <div class="progress-bar bg-success" role="progressbar" style="width:<%=(present/total)*100%>%" aria-valuenow=" <%=present%>" aria-valuemin="0" aria-valuemax="100"></div>
                       </div>
                     </div>
                   </div>

                      
                       
                       
                </div>
              </div>
              <div class="col-auto">
                <i class="fas fa-check-circle fa-2x text-gray-300"></i>
              
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Earnings (Monthly) Card Example -->
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">At Home
                </div>
                <div class="row no-gutters align-items-center">
                  <div class="col-auto">
                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800"><%=home%></div>
                  </div>

                  <div class="col">
                    <div class="progress progress-sm mr-2">
                      <div class="progress-bar bg-info" role="progressbar" style="width: <%=(home/total)*100%>%" aria-valuenow="<%=home%>"
                        aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-auto">
                <i class="fas fa-home fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Requests Card Example -->
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                  Absent</div>

 <div class="row no-gutters align-items-center">
   <div class="col-auto">
     <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800"><%=absent%></div>
   </div>

   <div class="col">
     <div class="progress progress-sm mr-2">
       <div class="progress-bar bg-warning" role="progressbar" style="width: <%=(absent/total)*100%>%" aria-valuenow="<%=absent%>" aria-valuemin="0" aria-valuemax="100"></div>
     </div>
   </div>
 </div>



               
              </div>
              <div class="col-auto">
                <i class="fas fa-times-circle fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    

    <!-- Content Row -->

    <div class="row">

      <!-- Area Chart -->
      <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
          <!-- Card Header - Dropdown -->
          <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
            <h6 class="m-0 font-weight-bold text-primary">Attendance chart</h6>
          </div>
          <!-- Card Body -->
          <div class="card-body">
            <div class="chart-area">



              <div id="container" style="width: 100%; height: 100%"></div>

              
                <div id="presentstudents" hidden><%=present%></div>
                  <div id="absentstudents" hidden><%=absent%></div>
                    <div id="homestudents" hidden><%=home%></div>



<script>

       
         let presentstudents=document.getElementById("presentstudents").innerHTML;
          let absentstudents=document.getElementById("absentstudents").innerHTML;
           let homestudents=document.getElementById("homestudents").innerHTML;
               var data = [
                  {
                    x: "In Hostel", value: presentstudents, normal: {
                      fill: "#1cc88a"
                    }
                  },

                  {
                    x: "At Home", value: homestudents, normal: {
                      fill: "#36b9cc"
                    }
                  },
                  {
                    x: "Absent", value: absentstudents, normal: {
                      fill: "#f6c23e"
                    }
                  },

                ];
          
              
                // create the chart
                 var chart = anychart.pie();
 
                // set the chart title
                chart.title("Records");

                // add the data
                chart.data(data);

                // display the chart in the container
                chart.container('container');
                chart.draw();

          </script>

     









            </div>
          </div>
        </div>
      </div>




   


      <!-- Pie Chart -->
      <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
          <!-- Card Header - Dropdown -->
          <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
            <h6 class="m-0 font-weight-bold text-primary">Clock</h6>
          </div>
          <!-- Card Body -->
          <div class="card-body">



            <section class="clock container">
              <div class="clock__container grid">
                <div class="clock__content grid">
                  <div class="clock__circle">
                    <span class="clock__twelve"></span>
                    <span class="clock__three"></span>
                    <span class="clock__six"></span>
                    <span class="clock__nine"></span>

                    <div class="clock__rounder"></div>
                    <div class="clock__hour" id="clock-hour"></div>
                    <div class="clock__minutes" id="clock-minutes"></div>
                    <div class="clock__seconds" id="clock-seconds"></div>



                  </div>

                  <div>
                    <div class="clock__text">
                      <div class="clock__text-hour" id="text-hour"></div>
                      <div class="clock__text-minutes" id="text-minutes"></div>
                      <div class="clock__text-ampm" id="text-ampm"></div>
                    </div>

                    <div class="clock__date">
                      <!-- <span id="date-day-week"></span> -->
                      <span id="date-day"></span>
                      <span id="date-month"></span>
                      <span id="date-year"></span>
                    </div>
                  </div>
                </div>


              </div>
            </section>



          </div>





        </div>
      </div>
    </div>
  </div>





  <!-- Content Row -->
  <div class="row justify-content-center">


    <!-- Content Column -->
    <div class="col-lg-6 mb-4">


      <div class="my-5">
        <!-- <div class="row justify-content-center text-center mb-4">
                <h2>Available files are listed below</h2>
            </div> -->
        <div class="row justify-content-center">
            <h3 class="mb-5">All Records</h3>
            
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12 table-responsive">
            <table class="table table-hover align-middle text-center display" id="table_id" style="border:none">
              <thead>
                <tr>

                  <th scope="col">Room No</th>
                  <th scope="col">Name</th>
                  <th scope="col">Email</th>
                  <th scope="col">Contact</th>

                </tr>
              </thead>
              <tbody>
                 <%if(users!="NULL"){%>
                <%users.forEach(function(user){%>
                  <tr>
                    <td>
                      <%=user.room%>
                    </td>
                    <td>
                      <%=user.name%>
                    </td>
                    <td>
                      <%=user.email%>
                    </td>
                    <td>
                      <%=user.contact%>
                    </td>
                   
                  </tr>
                  <% })%>
                  <%}%>

              </tbody>
            </table>
          </div>
        </div>
      </div>






    </div>

  </div>
  <!-- /.container-fluid -->

  </div>
  <!-- End of Main Content -->


<!-- Admin section end's here -->




  <!-- Footer -->
  <footer class="sticky-footer bg-white">
    <div class="container my-auto">
      <div class="copyright text-center my-auto">
        <span>Copyright &copy; Abhishek Dhar</span>
      </div>
    </div>
  </footer>
  <!-- End of Footer -->

  </div>
  <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>


  <%-include("../footer")-%>



  <script>
    $(document).ready(function () {
      $('#table_id').DataTable({
        autoWidth: false,
        columnDefs: [{
          targets: ['_all'],
          className: 'mdc-data-table__cell'
        }],
        "columns": [{
          "width": "5%"
        },
        {
          "width": "7%"
        },
        {
          "width": "17%"
        },
        {
          "width": "7%"
        },
        

        ],
        "lengthChange": true,
        "paging": true,
        "info": false
      });
    });




   function pdf()
   {

   const data=document.getElementById("wrap");
   let date=new Date();
   var opt = {
   margin: 0.3,
   filename: `Report_${date.toLocaleString()}.pdf`,
   image: { type: 'jpeg', quality: 2 },
   html2canvas: { scale: 2 },
   jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }




   };

  html2pdf().from(data).set(opt).save();

   }





  </script>


  </body>

  </html>